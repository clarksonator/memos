<% if user_signed_in? %>
  <%= csrf_meta_tag %>
  <script>
        function openModal() {
            document.getElementById("modal1")
                .classList.add("is-active");
        }
  </script>
  <div style="margin: 0 auto;width: 800px; height: 100%">
    <%= render "layouts/new" %>
    <% current_user.memos.each do |memo| %>
      <%= render partial: "layouts/memo", object: memo %>
    <% end %>
  </div>
  <script>
  document.querySelectorAll('.modal-background, .modal-close,.modal-card-head .delete, .modal-card-foot .button').forEach(($el) => {const $modal = $el.closest('.modal');$el.addEventListener('click', () => {$modal.classList.remove("is-active");});});

  $("#editMemo").on("click", function() {
    $(this).parent().children("#saveMemo").show();
    $(this).parent().children("#cancelEdit").show();
    $(this).parent().children("#editMemo").hide();
    var card = $(this).parent().parent().parent();
    card.children(".viewMemo").hide();
    card.children(".updateMemo").show();
  });
  $("#cancelEdit").on("click", function() {
    $(this).parent().children("#saveMemo").hide();
    $(this).parent().children("#cancelEdit").hide();
    $(this).parent().children("#editMemo").show();
    var card = $(this).parent().parent().parent();
    card.children(".viewMemo").show();
    card.children(".updateMemo").hide();
  });
  $("#saveMemo").on("click", function() {
    var card = $(this).parent().parent().parent();
    var url = card.children(".updateMemo").data('url');
    var body = card.find("#editMemoTA").val();
    $.ajax({
      url: url,
      beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
      data: "memo%5Bbody%5D="+encodeURIComponent(body),
      dataType: "html",
      type: 'PUT',
      success: function(result) {
        var memoDiv = card.parents("#memo");
        memoDiv.replaceWith(result);
      }
    });
  });
  </script>
<% end %>
